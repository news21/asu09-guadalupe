package {		import flash.display.Sprite;	import flash.events.Event;	import flash.events.MouseEvent;	import flash.display.MovieClip;	import fl.events.SliderEvent;	import fl.controls.Label;	import flash.text.TextFormat;	import flash.display.Loader;	import flash.net.URLRequest;	import flash.text.TextField;	import flash.net.URLLoader;		import com.flashdo.flashblue.*;	import VimeoPlayer;		import org.papervision3d.view.Viewport3D;	import org.papervision3d.scenes.Scene3D;	import org.papervision3d.cameras.Camera3D;	import org.papervision3d.materials.ColorMaterial;	import org.papervision3d.objects.primitives.Plane;	import org.papervision3d.events.InteractiveScene3DEvent;	import org.papervision3d.render.BasicRenderEngine;	import org.papervision3d.core.render.filter.FogFilter;	import org.papervision3d.materials.special.FogMaterial;	import org.papervision3d.objects.DisplayObject3D;	import org.papervision3d.materials.BitmapFileMaterial;	import org.papervision3d.materials.MovieMaterial;	import org.papervision3d.materials.MovieAssetMaterial;	import org.papervision3d.core.geom.Lines3D;	import org.papervision3d.core.geom.renderables.Line3D;  	import org.papervision3d.materials.special.LineMaterial;  	import org.papervision3d.core.geom.renderables.Vertex3D;		import org.as3lib.kitchensync.*;    import org.as3lib.kitchensync.action.*;    import org.as3lib.kitchensync.easing.*;	[SWF(backgroundColor="#000000")]	public class Guadalupe extends Sprite	{		private var urlPath:String =  '/assets/guadalupe/';		private var introTextUrl:String = urlPath+"assets/intro.txt";				private var viewport: Viewport3D;		private var scene: Scene3D;		private var camera: Camera3D;				private var previewMaterial1: BitmapFileMaterial;		private var previewMaterial2: BitmapFileMaterial;		private var previewMaterial3: BitmapFileMaterial;				private var colorMaterial0: BitmapFileMaterial;		private var colorMaterial1:	BitmapFileMaterial;		private var colorMaterial2:	BitmapFileMaterial;		private var colorMaterial3:	BitmapFileMaterial;		private var colorMaterial4:	BitmapFileMaterial;		private var renderer: BasicRenderEngine;		private var lineMaterial:LineMaterial;		private var movieMaterial0:MovieAssetMaterial;		private var movieMaterial1:MovieAssetMaterial;				private var introFormat:TextFormat;		private var myFormat:TextFormat;		private var chkLabel1:TextFormat;		private var chkLabel2:TextFormat;		private var chkLabel3:TextFormat;		private var chkLabel4:TextFormat;		private var chkLabel5:TextFormat;		private var planeTitle:Label;		private var arrLines:Array = [];		private var _objArray:Array = [];				protected static const appWidth:int = 752;		protected static const appHeight:int = 500;		protected static const planeWidth:int = 496;		protected static const planeHeight:int = 470;		protected static const anchorX:Number = (appWidth*0.5)+(planeWidth*0.5);		protected static const anchorY:Number = (appHeight*0.5);		protected static const cameraPanXMin:Number = -75;		protected static const cameraPanYMin:Number = 5;		protected static const cameraRotateXMin:Number = 12;		protected static const cameraRotateYMin:Number = 3;		protected static const ttipHeight:int = 54;		protected static const ttipWidth:int = 200;		protected static const ttipPadding:int = 10;				private var tooltip:toolTip;		private var bToolTip:Boolean = true;				private var aPlanes:Array = [];		private var currentPlane:int = 0;		private var nextPlane:int = 0;				private var aTransitions:Array = [];		private var bInTransition:Boolean = false;		private var currentTransition:int = 0;				protected static const fogMin:Number = 10000;		protected static const fogDepth:Number = 100000;		protected static const fogSegments:Number = 10;				public var skipIntroBtn:GotoTourButton;		public var introTextLoader:URLLoader;		public var intro_overlay:MovieClip;		public var scroll_area:MakeScrollBar;		public var scrollbar_mc:Scrollbar;		public var scroll_text:TextField;				public var didit:Boolean = false;		public var linksWall:LinksDisplay;		public var slideShow:Banner;		public var vplayer:VimeoPlayer;		public var aplayer:AudioPlayer;		public var bLines:Boolean;				public function Guadalupe():void		{			//viewport = new BasicRenderEngine(width, height, scaleToStage, interactive);			viewport = new Viewport3D(appWidth, appHeight, false, true);			addChildAt(viewport,0);			viewport.x=0;			viewport.y=0;						//instantiates a Scene3D instance			scene = new Scene3D();						//instantiates a Camera3D instance			camera = new Camera3D();			camera.zoom = 35;						//renderer draws the scene to the stage			renderer = new BasicRenderEngine();						// set framerate to 30 frames per second & start KitchenSync. You'll only need to do this once.			stage.frameRate = 30;			KitchenSync.initialize(this);									lineMaterial = new LineMaterial(0xffffff,.1);			lineMaterial.lineThickness = .1;            var line:Lines3D = new Lines3D(lineMaterial, "line");            arrLines.push(line);            scene.addChild(line, 'line');			bLines = false;									myFormat = new TextFormat();			myFormat.font = "Verdana";			myFormat.size = 22;			myFormat.color = 0xffffff;									introFormat = new TextFormat();			introFormat.font = "Verdana";			introFormat.size = 12;			introFormat.color = 0xffffff;									chkLabel1 = new TextFormat();			chkLabel1.color = 0xD92414;						chkLabel2 = new TextFormat();			chkLabel2.color = 0x029399;						chkLabel3 = new TextFormat();			chkLabel3.color = 0x11A954;						chkLabel4 = new TextFormat();			chkLabel4.color = 0xEEC805;						chkLabel5 = new TextFormat();			chkLabel5.color = 0xF26B1B;						btn_zoomout.buttonMode = true;			btn_zoomout.useHandCursor = true;						btn_moreinfo.buttonMode = true;			btn_moreinfo.useHandCursor = true;						cb_slideshows.chk_slideshows.setStyle("textFormat",chkLabel1);			cb_videos.chk_videos.setStyle("textFormat",chkLabel2);			cb_audio.chk_audio.setStyle("textFormat",chkLabel3);			cb_links.chk_links.setStyle("textFormat",chkLabel4);			cb_maps.chk_map.setStyle("textFormat",chkLabel5);						cb_maps.chk_map.visible = false;						tooltip = new toolTip();			tooltip.name = 'toolTip';			tooltip.bg.alpha = .8;			addChild(tooltip);			tooltip.alpha = 0;						introTextLoader = new URLLoader();			introTextLoader.addEventListener(Event.COMPLETE, insertIntroText);			introTextLoader.load(new URLRequest(introTextUrl));			scrollbar_mc = new Scrollbar();			scrollbar_mc.height = 350;			scrollbar_mc.width = 15;			scrollbar_mc.x = (((appWidth-500)*.5)-scrollbar_mc.width)+500;			scrollbar_mc.y = 75;			scroll_text = new TextField();			scroll_text.selectable = true;			scroll_text.wordWrap = true;			scroll_text.width = 500;			scroll_text.height = 350;			scroll_text.x = (((appWidth-500)*.5)-scrollbar_mc.width);			scroll_text.y = 75;			scroll_area = new MakeScrollBar( scrollbar_mc, scrollText );			intro_overlay = new MovieClip();			intro_overlay.name = "introOverlay";			intro_overlay.graphics.beginFill(0x000000);			intro_overlay.graphics.drawRect(0, 0, appWidth, appHeight);			intro_overlay.graphics.endFill();			intro_overlay.x = 0;			intro_overlay.y = 0;			intro_overlay.alpha = .85;						skipIntroBtn = new GotoTourButton();			skipIntroBtn.useHandCursor = true;			skipIntroBtn.buttonMode = true;			skipIntroBtn.addEventListener(MouseEvent.CLICK, fadeOutIntroOverlay);			skipIntroBtn.y = 50;			skipIntroBtn.x = (((appWidth-500)*.5)-scrollbar_mc.width)+400;						intro_overlay.addChild(skipIntroBtn);			intro_overlay.addChild(scrollbar_mc);			intro_overlay.addChild(scroll_text);												planeTitle = new Label();			planeTitle.setStyle("textFormat", myFormat);			addChild(planeTitle);			planeTitle.visible = false;            						previewMaterial1 = new BitmapFileMaterial(urlPath+"assets/images/node_1_preview.png");			previewMaterial1.interactive = true;			previewMaterial2 = new BitmapFileMaterial(urlPath+"assets/images/node_2_preview.png");			previewMaterial2.interactive = true;			previewMaterial3 = new BitmapFileMaterial(urlPath+"assets/images/node_3_preview.png");			previewMaterial3.interactive = true;									//ColorMaterial, doubleSided draws the color on both sides of the geometry normals			colorMaterial0 = new BitmapFileMaterial(urlPath+"assets/images/green.png");			colorMaterial0.interactive = true;						colorMaterial1 = new BitmapFileMaterial(urlPath+"assets/images/blue.png");			colorMaterial1.interactive = true;						colorMaterial2 = new BitmapFileMaterial(urlPath+"assets/images/red.png");			colorMaterial2.interactive = true;						colorMaterial3 = new BitmapFileMaterial(urlPath+"assets/images/yellow.png");			colorMaterial3.interactive = true;						colorMaterial4 = new BitmapFileMaterial(urlPath+"assets/images/orange.png");			colorMaterial4.interactive = true;						// Create a new flash movie material from an embedded flash movie (not transparent, animated and precise rendering)      		movieMaterial0 = new MovieAssetMaterial("Vimeo", false, true, true);			movieMaterial0.interactive = true;			//set up enterFrame event			addEventListener(Event.ENTER_FRAME, onEnterFrame);						aPlanes = [{'material':previewMaterial1,'width':planeWidth,'height':planeHeight,'x':0,'y':1000,'z':1500,'enableRotate':false,'alias':'1','type':'video','title':'Origin Story','parent_alias':'','data':'5747308'},					   {'material':previewMaterial2,'width':planeWidth,'height':planeHeight,'x':0,'y':0,'z':1500,'enableRotate':false,'alias':'2','type':'video','title':'Her History and Crossing the Border','parent_alias':'','data':'5747546'},					   {'material':previewMaterial3,'width':planeWidth,'height':planeHeight,'x':0,'y':-1000,'z':1500,'enableRotate':false,'alias':'3','type':'video','title':'She Spreads Through the World.','parent_alias':'','data':'5747622'},					   					   {'material':colorMaterial1,'width':planeWidth,'height':planeHeight,'x':-2750,'y':4750,'z':6750,'enableRotate':false,'alias':'1a','type':'video','title':'Basilica of the Virgen','parent_alias':'1','data':'5742985'},					   {'material':colorMaterial2,'width':planeWidth,'height':planeHeight,'x':-2250,'y':6750,'z':8750,'enableRotate':false,'alias':'1a1','type':'slideshow','title':'Swine flu','parent_alias':'1a','data':'assets/xml/1a1.xml'},					   {'material':colorMaterial3,'width':planeWidth,'height':planeHeight,'x':-4500,'y':7000,'z':8750,'enableRotate':false,'alias':'1a2','type':'links','title':'Links','parent_alias':'1a','data':'assets/xml/1a2.xml'},					   {'material':colorMaterial1,'width':planeWidth,'height':planeHeight,'x':-4000,'y':3250,'z':6750,'enableRotate':false,'alias':'1b','type':'video','title':'The Pilgrims','parent_alias':'1','data':'5742872'},					   					   {'material':colorMaterial2,'width':planeWidth,'height':planeHeight,'x':-7000,'y':3250,'z':8750,'enableRotate':false,'alias':'1b2','type':'slideshow','title':'Portraits of the Pilgrims','parent_alias':'1b','data':'assets/xml/1b2.xml'},					   {'material':colorMaterial2,'width':planeWidth,'height':planeHeight,'x':-3750,'y':2750,'z':8750,'enableRotate':false,'alias':'1b3','type':'slideshow','title':'The Road Home','parent_alias':'1b','data':'assets/xml/1b3.xml'},					   {'material':colorMaterial2,'width':planeWidth,'height':planeHeight,'x':3750,'y':2750,'z':6750,'enableRotate':false,'alias':'1c','type':'slideshow','title':'Symbolic Image','parent_alias':'1','data':'assets/xml/1c.xml'},					   {'material':colorMaterial2,'width':planeWidth,'height':planeHeight,'x':3750,'y':5000,'z':8750,'enableRotate':false,'alias':'1c1','type':'slideshow','title':'Prayer','parent_alias':'1c','data':'assets/xml/1c1.xml'},					   {'material':colorMaterial2,'width':planeWidth,'height':planeHeight,'x':5250,'y':5750,'z':8750,'enableRotate':false,'alias':'1c2','type':'slideshow','title':'Another Prayer Card','parent_alias':'1c','data':'assets/xml/1c2.xml'},					   {'material':colorMaterial3,'width':planeWidth,'height':planeHeight,'x':7500,'y':5250,'z':8750,'enableRotate':false,'alias':'1c3','type':'links','title':'Links','parent_alias':'1c','data':'assets/xml/1c3.xml'},					   {'material':colorMaterial2,'width':planeWidth,'height':planeHeight,'x':6500,'y':3750,'z':8750,'enableRotate':false,'alias':'1c4','type':'slideshow','title':'Greeting Card','parent_alias':'1c','data':'assets/xml/1c4.xml'},					   {'material':colorMaterial2,'width':planeWidth,'height':planeHeight,'x':7250,'y':2000,'z':8750,'enableRotate':false,'alias':'1c5','type':'slideshow','title':'Magnet','parent_alias':'1c','data':'assets/xml/1c5.xml'},					   {'material':colorMaterial2,'width':planeWidth,'height':planeHeight,'x':5250,'y':1750,'z':8750,'enableRotate':false,'alias':'1c6','type':'slideshow','title':'Shopping Bag','parent_alias':'1c','data':'assets/xml/1c6.xml'},					   					   {'material':colorMaterial2,'width':planeWidth,'height':planeHeight,'x':1500,'y':4750,'z':6750,'enableRotate':false,'alias':'1d','type':'slideshow','title':'Profiles','parent_alias':'1','data':'assets/xml/1d.xml'},					   {'material':colorMaterial3,'width':planeWidth,'height':planeHeight,'x':1250,'y':7250,'z':8750,'enableRotate':false,'alias':'1d1','type':'links','title':'Links','parent_alias':'1d','data':'assets/xml/1d1.xml'},					   					   {'material':colorMaterial1,'width':planeWidth,'height':planeHeight,'x':-2000,'y':1000,'z':6750,'enableRotate':false,'alias':'2a','type':'video','title':'Anthropologist','parent_alias':'2','data':'5749092'},					   {'material':colorMaterial0,'width':planeWidth,'height':planeHeight,'x':-2000,'y':2250,'z':8750,'enableRotate':false,'alias':'2a1','type':'audio','title':'Audio','parent_alias':'2a','data':'assets/xml/2a1.xml'},					   {'material':colorMaterial3,'width':planeWidth,'height':planeHeight,'x':-3500,'y':1750,'z':8750,'enableRotate':false,'alias':'2a2','type':'links','title':'Links','parent_alias':'2a','data':'assets/xml/2a2.xml'},					   {'material':colorMaterial2,'width':planeWidth,'height':planeHeight,'x':-4750,'y':750,'z':6750,'enableRotate':false,'alias':'2b','type':'slideshow','title':'Historic Images','parent_alias':'2','data':'assets/xml/2b.xml'},					   {'material':colorMaterial1,'width':planeWidth,'height':planeHeight,'x':-2750,'y':-250,'z':6750,'enableRotate':false,'alias':'2c','type':'video','title':'A Cultural spread','parent_alias':'2','data':'5749797'},					   {'material':colorMaterial2,'width':planeWidth,'height':planeHeight,'x':-4500,'y':1250,'z':8750,'enableRotate':false,'alias':'2c1','type':'slideshow','title':'A Cultural Spread','parent_alias':'2c','data':'assets/xml/2c1.xml'},					   {'material':colorMaterial3,'width':planeWidth,'height':planeHeight,'x':-4500,'y':250,'z':8750,'enableRotate':false,'alias':'2c2','type':'links','title':'Links','parent_alias':'2c','data':'assets/xml/2c2.xml'},					   {'material':colorMaterial1,'width':planeWidth,'height':planeHeight,'x':-5000,'y':-750,'z':6750,'enableRotate':false,'alias':'2d','type':'video','title':'Cult of Saints','parent_alias':'2','data':'5750476'},					   {'material':colorMaterial2,'width':planeWidth,'height':planeHeight,'x':-7500,'y':750,'z':8750,'enableRotate':false,'alias':'2d1','type':'slideshow','title':'Santa Muerte Novena Book','parent_alias':'2d','data':'assets/xml/2d1.xml'},					   {'material':colorMaterial2,'width':planeWidth,'height':planeHeight,'x':-8250,'y':-250,'z':8750,'enableRotate':false,'alias':'2d2','type':'slideshow','title':'Santa Muerte\'s true colors','parent_alias':'2d','data':'assets/xml/2d2.xml'},					   {'material':colorMaterial2,'width':planeWidth,'height':planeHeight,'x':-9500,'y':-750,'z':8750,'enableRotate':false,'alias':'2d3','type':'slideshow','title':'Santa Muerte Culta','parent_alias':'2d','data':'assets/xml/2d3.xml'},					   {'material':colorMaterial3,'width':planeWidth,'height':planeHeight,'x':-10500,'y':500,'z':10750,'enableRotate':false,'alias':'2d3a','type':'links','title':'Links','parent_alias':'2d3','data':'assets/xml/2d3a.xml'},					   {'material':colorMaterial2,'width':planeWidth,'height':planeHeight,'x':-7750,'y':-1750,'z':8750,'enableRotate':false,'alias':'2d4','type':'slideshow','title':'Santo Romo','parent_alias':'2d','data':'assets/xml/2d4.xml'},					   {'material':colorMaterial0,'width':planeWidth,'height':planeHeight,'x':-6250,'y':-1750,'z':10750,'enableRotate':false,'alias':'2d4a','type':'audio','title':'Santo Romo\'s Prayer','parent_alias':'2d4','data':'assets/xml/2d4a.xml'},					   {'material':colorMaterial3,'width':planeWidth,'height':planeHeight,'x':-10500,'y':1500,'z':10750,'enableRotate':false,'alias':'2d4b','type':'links','title':'Links','parent_alias':'2d4','data':'assets/xml/2d4b.xml'},					   {'material':colorMaterial2,'width':planeWidth,'height':planeHeight,'x':-6750,'y':-2500,'z':8750,'enableRotate':false,'alias':'2d5','type':'slideshow','title':'Malverde','parent_alias':'2d','data':'assets/xml/2d5.xml'},					   {'material':colorMaterial3,'width':planeWidth,'height':planeHeight,'x':-8000,'y':-3000,'z':8750,'enableRotate':false,'alias':'2d5a','type':'links','title':'Links','parent_alias':'2d5','data':'assets/xml/2d5a.xml'},					   {'material':colorMaterial0,'width':planeWidth,'height':planeHeight,'x':-5000,'y':-2250,'z':8750,'enableRotate':false,'alias':'2d6','type':'audio','title':'La Mistica','parent_alias':'2d','data':'assets/xml/2d6.xml'},					   {'material':colorMaterial2,'width':planeWidth,'height':planeHeight,'x':-2000,'y':-1250,'z':6750,'enableRotate':false,'alias':'2e','type':'slideshow','title':'Chavos de Monterrey','parent_alias':'2','data':'assets/xml/2e.xml'},					   {'material':colorMaterial2,'width':planeWidth,'height':planeHeight,'x':1500,'y':-1750,'z':6750,'enableRotate':false,'alias':'2f','type':'slideshow','title':'Cowboy Shirts','parent_alias':'2','data':'assets/xml/2f.xml'},					   {'material':colorMaterial3,'width':planeWidth,'height':planeHeight,'x':3500,'y':-2250,'z':8750,'enableRotate':false,'alias':'2f1','type':'links','title':'Links','parent_alias':'2f','data':'assets/xml/2f1.xml'},					   {'material':colorMaterial1,'width':planeWidth,'height':planeHeight,'x':5250,'y':0,'z':6750,'enableRotate':false,'alias':'2g','type':'video','title':'Two D.C. neighborhoods','parent_alias':'2','data':'5795738'},					   {'material':colorMaterial1,'width':planeWidth,'height':planeHeight,'x':8250,'y':-250,'z':8750,'enableRotate':false,'alias':'2g1','type':'video','title':'Columbia Heights','parent_alias':'2g','data':'5760764'},					   {'material':colorMaterial1,'width':planeWidth,'height':planeHeight,'x':7500,'y':1250,'z':8750,'enableRotate':false,'alias':'2g2','type':'video','title':'Adams Morgan','parent_alias':'2g','data':'5760650'},					   {'material':colorMaterial2,'width':planeWidth,'height':planeHeight,'x':2000,'y':750,'z':6750,'enableRotate':false,'alias':'2h','type':'slideshow','title':'Teocintli\'s Virgin','parent_alias':'2','data':'assets/xml/2h.xml'},					   					   {'material':colorMaterial1,'width':planeWidth,'height':planeHeight,'x':-2750,'y':-3000,'z':6750,'enableRotate':false,'alias':'3a','type':'video','title':'Virgin in Japan','parent_alias':'3','data':'5761363'},					   {'material':colorMaterial1,'width':planeWidth,'height':planeHeight,'x':-3250,'y':-2750,'z':8750,'enableRotate':false,'alias':'3a1','type':'video','title':'Lowriding in Japan','parent_alias':'3a','data':'5761514'},					   {'material':colorMaterial1,'width':planeWidth,'height':planeHeight,'x':-5500,'y':-4000,'z':8750,'enableRotate':false,'alias':'3a2','type':'video','title':'Brazilians in Japan','parent_alias':'3a','data':'5794563'},					   {'material':colorMaterial2,'width':planeWidth,'height':planeHeight,'x':-4000,'y':-5000,'z':8750,'enableRotate':false,'alias':'3a3','type':'slideshow','title':'Lowrider Magazine','parent_alias':'3a','data':'assets/xml/3a3.xml'},					   {'material':colorMaterial2,'width':planeWidth,'height':planeHeight,'x':-4000,'y':-6000,'z':8750,'enableRotate':false,'alias':'3a4','type':'slideshow','title':'Lowriding in Tucson','parent_alias':'3a','data':'assets/xml/3a4.xml'},					   {'material':colorMaterial1,'width':planeWidth,'height':planeHeight,'x':-4750,'y':-4750,'z':6750,'enableRotate':false,'alias':'3b','type':'video','title':'Virgin in the Phillipines','parent_alias':'3','data':'5762653'},					   {'material':colorMaterial1,'width':planeWidth,'height':planeHeight,'x':-7750,'y':-6000,'z':8750,'enableRotate':false,'alias':'3b1','type':'video','title':'Manila, they go to the Philippines','parent_alias':'3b','data':'5762552'},					   {'material':colorMaterial2,'width':planeWidth,'height':planeHeight,'x':-8250,'y':-7250,'z':8750,'enableRotate':false,'alias':'3b2','type':'slideshow','title':'Her prayers in the Philippines','parent_alias':'3b','data':'assets/xml/3b2.xml'},					   {'material':colorMaterial2,'width':planeWidth,'height':planeHeight,'x':-6250,'y':-7750,'z':8750,'enableRotate':false,'alias':'3b3','type':'slideshow','title':'Vladimir\'s Paintings','parent_alias':'3b','data':'assets/xml/3b3.xml'},					   {'material':colorMaterial2,'width':planeWidth,'height':planeHeight,'x':-1500,'y':-5500,'z':6750,'enableRotate':false,'alias':'3c','type':'slideshow','title':'Our Lady of Controversy','parent_alias':'3','data':'assets/xml/3c.xml'},					   {'material':colorMaterial3,'width':planeWidth,'height':planeHeight,'x':-3750,'y':-7250,'z':8750,'enableRotate':false,'alias':'3c1','type':'links','title':'Links','parent_alias':'3c','data':'assets/xml/3c1.xml'},					   {'material':colorMaterial1,'width':planeWidth,'height':planeHeight,'x':1750,'y':-5000,'z':6750,'enableRotate':false,'alias':'3d','type':'video','title':'Virgin and Women','parent_alias':'3','data':'5775578'},					   {'material':colorMaterial1,'width':planeWidth,'height':planeHeight,'x':250,'y':-6500,'z':8750,'enableRotate':false,'alias':'3d1','type':'video','title':'Raquel Guttierez','parent_alias':'3d','data':'5762808'},					   {'material':colorMaterial2,'width':planeWidth,'height':planeHeight,'x':250,'y':-6500,'z':10750,'enableRotate':false,'alias':'3d1a','type':'slideshow','title':'Raquel Guttierez','parent_alias':'3d1','data':'assets/xml/3d1a.xml'},					   {'material':colorMaterial1,'width':planeWidth,'height':planeHeight,'x':1500,'y':-7500,'z':8750,'enableRotate':false,'alias':'3d2','type':'video','title':'Anita Madrigal','parent_alias':'3d','data':'5773136'},					   {'material':colorMaterial2,'width':planeWidth,'height':planeHeight,'x':1500,'y':-7500,'z':10750,'enableRotate':false,'alias':'3d2a','type':'slideshow','title':'Anita Madrigal','parent_alias':'3d','data':'assets/xml/3d2a.xml'},					   {'material':colorMaterial1,'width':planeWidth,'height':planeHeight,'x':4000,'y':-7000,'z':8750,'enableRotate':false,'alias':'3d3','type':'video','title':'Ashley Pinedo','parent_alias':'3d','data':'5773531'},					   {'material':colorMaterial3,'width':planeWidth,'height':planeHeight,'x':4000,'y':-7250,'z':10750,'enableRotate':false,'alias':'3d3a','type':'links','title':'Links','parent_alias':'3d3','data':'assets/xml/3d3a.xml'},					   {'material':colorMaterial1,'width':planeWidth,'height':planeHeight,'x':5500,'y':-4750,'z':6750,'enableRotate':false,'alias':'3e','type':'video','title':'Virgin in Tattoos','parent_alias':'3','data':'5761610'},					   {'material':colorMaterial2,'width':planeWidth,'height':planeHeight,'x':5750,'y':-7500,'z':8750,'enableRotate':false,'alias':'3e1','type':'slideshow','title':'Virgin in more tattoos','parent_alias':'3e','data':'assets/xml/3e1.xml'},					   {'material':colorMaterial2,'width':planeWidth,'height':planeHeight,'x':3250,'y':-3500,'z':6750,'enableRotate':false,'alias':'3f','type':'slideshow','title':'Rockabilly Virgin','parent_alias':'3','data':'assets/xml/3f.xml'},					   {'material':colorMaterial3,'width':planeWidth,'height':planeHeight,'x':3750,'y':-5500,'z':8750,'enableRotate':false,'alias':'3f1','type':'links','title':'Links','parent_alias':'3f','data':'assets/xml/3f1a.xml'},					   {'material':colorMaterial2,'width':planeWidth,'height':planeHeight,'x':5750,'y':-2500,'z':8750,'enableRotate':false,'alias':'3f2','type':'slideshow','title':'Marca del Diablo','parent_alias':'3f','data':'assets/xml/3f2.xml'},					   {'material':colorMaterial0,'width':planeWidth,'height':planeHeight,'x':4250,'y':-2750,'z':6750,'enableRotate':false,'alias':'3g','type':'audio','title':'Sonia Sotomayor as the Virgin','parent_alias':'3','data':'assets/xml/3g.xml'}					  ];			//{'material':colorMaterial2,'width':planeWidth,'height':planeHeight,'x':3250,'y':2250,'z':8750,'enableRotate':false,'alias':'1c7','type':'slideshow','title':'Candles','parent_alias':'1c','data':'assets/xml/1c7.xml'},									//{'material':colorMaterial4,'width':planeWidth,'height':planeHeight,'x':-6500,'y':5250,'z':8750,'enableRotate':false,'alias':'1b1','type':'map','title':'Chalma Pilgrim\'s Route','parent_alias':'1b','data':''},						//{'material':colorMaterial0,'width':planeWidth,'height':planeHeight,'x':3750,'y':-5500,'z':8750,'enableRotate':false,'alias':'3f1','type':'audio','title':'Rockabilly Ray','parent_alias':'3f','data':'assets/xml/1d1.xml'},			//{'material':colorMaterial3,'width':planeWidth,'height':planeHeight,'x':3750,'y':-5500,'z':10750,'enableRotate':false,'alias':'3f1a','type':'links','title':'Links','parent_alias':'3f1','data':'assets/xml/3f1a.xml'},					   						for(var i:int=0;i<aPlanes.length;i++){				var plane = new Plane(aPlanes[i]['material'],aPlanes[i]['width'],aPlanes[i]['height'],2,2);				plane.name = 'plane_'+i				scene.addChild(plane);				plane.x = aPlanes[i]['x'];				plane.y = aPlanes[i]['y'];				plane.z = aPlanes[i]['z'];								plane.addEventListener(InteractiveScene3DEvent.OBJECT_PRESS, onPress);				plane.addEventListener(InteractiveScene3DEvent.OBJECT_OVER, onMouseOver);				plane.addEventListener(InteractiveScene3DEvent.OBJECT_OUT, onMouseOut);			}						// plane onclick event handler			function onPress(e:InteractiveScene3DEvent):void			{				var sp:Array = e.renderHitData.displayObject3D.name.split('_');				nextPlane = int(sp[1]);				initTransition();			}						function onMouseOver(e:InteractiveScene3DEvent):void			{				if(bToolTip){					var sp:Array = e.renderHitData.displayObject3D.name.split('_');					var ttX:int = 0;					var ttY:int = 0;										if(stage.mouseY < ttipHeight+ttipPadding) {						ttY = stage.mouseY+ttipPadding;					} else {						ttY = stage.mouseY-ttipHeight-ttipPadding;					}										if(stage.mouseX > appWidth-ttipWidth) {						ttX = stage.mouseX-ttipWidth-ttipPadding;					} else {						ttX = stage.mouseX+ttipPadding;					}										var tt:toolTip  = getChildByName('toolTip') as toolTip;					tt.x = ttX;					tt.y = ttY;					var thumbLoader:Loader = new Loader();					thumbLoader.load(new URLRequest(urlPath+'assets/images/previews/'+aPlanes[sp[1]]['alias']+'.jpg'));					tt.snapshot.removeChildAt(0);					tt.snapshot.addChild(thumbLoader);					tt.txt_title.text = aPlanes[sp[1]]['title']; 					var tween:KSTween = new KSTween(tt, "alpha", 0, 0.85, "0.1sec", "0sec", Cubic.easeInOut);					tween.start();				}			}						function onMouseOut(e:InteractiveScene3DEvent):void			{				if(bToolTip){					hideToolTip();				}			}						//define enterFrame Method, render the PV3D Scene and animate the primitive			function onEnterFrame(e:Event):void			{				if(bInTransition)				{									}								if(aPlanes[currentPlane]['enableRotate']) {					var cp:Plane = scene.getChildByName('plane_'+currentPlane) as Plane;					var pX = ((stage.mouseX-anchorX)/-anchorX)*cameraPanXMin;					var pY = ((stage.mouseX-anchorX)/-anchorX)*cameraPanYMin;					var rmX = ((stage.mouseX-anchorX)/-anchorX)*cameraRotateXMin;					var rmY = ((stage.mouseY-anchorY)/-anchorY)*cameraRotateYMin;										if( (camera.x+pX) > (cp.x-(planeWidth*0.5)) && (camera.x+pX) < (cp.x+(planeWidth*0.5)) ) {						camera.rotationY = rmX;					}										if( (camera.y+pY) > (cp.y-(planeHeight*0.5)) && (camera.y+pY) < (cp.y+(planeHeight*0.5)) ) {						camera.rotationX = rmY;											}				} else {					camera.rotationX = 0;					camera.rotationY = 0;				}								renderer.renderScene(scene, camera, viewport);			}						setFogFilter();			initNav();		}				public function initTransition():void		{			hideToolTip();			hideLines();			moveCameraToPlane();			cleanPlane();		}				public function cleanPlane():void		{			if(aPlanes[currentPlane]['type'] == 'slideshow')			{				if(getChildByName('photoGallery')!= null){					removeChild(getChildByName('photoGallery'));					planeTitle.visible = false;				}			} else if(aPlanes[currentPlane]['type'] == 'links')			{				if(getChildByName('linksDisplay')!= null){					removeChild(getChildByName('linksDisplay'));					planeTitle.visible = false;				}			} else if(aPlanes[currentPlane]['type'] == 'video')			{				if(getChildByName('vimeoPlayer')!= null){					getChildByName('vimeoPlayer').visible = false;					vplayer.unloadVimeo();					removeChild(getChildByName('vimeoPlayer'));					planeTitle.visible = false;				}			} else if(aPlanes[currentPlane]['type'] == 'audio')			{				if(getChildByName('audioPlayer')!= null){					getChildByName('audioPlayer').visible = false;					aplayer.unloadAudio();					removeChild(getChildByName('audioPlayer'));					planeTitle.visible = false;				}			}		}				public function cleanTransition():void		{			bInTransition = false;		}				public function rotateCamera(rX:Number=0,rY:Number=0):void		{			camera.rotationX += rX;			camera.rotationY += rY;		}				public function moveCameraToPlane():void		{			var p:Plane = scene.getChildByName('plane_'+nextPlane) as Plane;						hideUnrelatedPlanes();						moveChildrenIntoView();						moveCameraTo(p.x,p.y,p.z-300);		}				public function moveChildrenIntoView():void 		{			var offsets:Array = [						   {'x': -2500, 'y':800, 'z':2000},						   {'x': 2500, 'y':800, 'z':2000},						   {'x': -2500, 'y':100, 'z':2000},						   {'x': 2500, 'y':100, 'z':2000},						   {'x': -2500, 'y':-600, 'z':2000},						   {'x': 2500, 'y':-600, 'z':2000},						   {'x': -2500, 'y':1500, 'z':2000},						   {'x': 2500, 'y':1500, 'z':2000},						   {'x': -2500, 'y':-1300, 'z':2000},						   {'x': 2500, 'y':-1300, 'z':2000}						   ];						var count:int = 0;			var p:Object = aPlanes[nextPlane];			var np:Plane = scene.getChildByName('plane_'+nextPlane) as Plane;			var cp:Plane;						for(var i:int=0;i<aPlanes.length;i++) {				if(aPlanes[i]['parent_alias'] == p['alias'])				{					cp = scene.getChildByName('plane_'+i) as Plane;					trace('about to show '+aPlanes[i]['alias']);					movePlaneTo(cp, (np.x+offsets[count].x),(np.y+offsets[count].y),(np.z+offsets[count].z),'2s');					cp.visible = true;					count++;				}			}		}				public function hideUnrelatedPlanes():void		{			var p:Object = aPlanes[nextPlane];			var cp:Plane;						for(var i:int=0;i<aPlanes.length;i++) {				if(aPlanes[i]['parent_alias'] != p['alias'] && nextPlane != i)				{					trace('about to hide '+aPlanes[i]['alias']);					cp = scene.getChildByName('plane_'+i) as Plane;					cp.visible = false;				}			}		}				public function showAllPlanes():void		{			var cp:Plane;			for(var i:int=0;i<aPlanes.length;i++) {				trace('about to show '+aPlanes[i]['alias']);				cp = scene.getChildByName('plane_'+i) as Plane;				cp.visible = true;			}								}				public function moveCameraTo(toX:Number,toY:Number,toZ:Number,initnode:Boolean=true):void		{			var tweenX:KSTween = new KSTween(camera, "x", camera.x, toX, "0.4sec", "0sec", Cubic.easeInOut);						var tweenY:KSTween = new KSTween(camera, "y", camera.y, toY, "0.5sec", "0sec", Cubic.easeInOut);			var tweenZ:KSTween = new KSTween(camera, "z", camera.z, toZ, "0.5sec", "0sec", Cubic.easeInOut);			var tweenDoneInitNode:KSFunction = new KSFunction(0, initNode);			var tweenDoneInitOverview:KSFunction = new KSFunction("1sec", initOverview);						var panCameraInline:KSParallelGroup = new KSParallelGroup(				tweenX,				tweenY			);						var zoomCameraIn:KSParallelGroup = new KSParallelGroup(        		tweenZ			);						var sequence:KSSequenceGroup;			if(initnode)				sequence = new KSSequenceGroup( panCameraInline, zoomCameraIn, tweenDoneInitNode );			else				sequence = new KSSequenceGroup( panCameraInline, zoomCameraIn, tweenDoneInitOverview );						sequence.start();		}				public function initNode():void		{			currentPlane = nextPlane;			nextPlane = 0;			cleanTransition();			hideNav();			hideToolTip();			trace('initialize the node '+aPlanes[currentPlane]['alias'].length);									if(aPlanes[currentPlane]['type'] == 'slideshow')			{				if(getChildByName('photoGallery')!= null)					removeChild(getChildByName('photoGallery'));								slideShow = new Banner(urlPath+aPlanes[currentPlane]['data'],urlPath)				this.addChild(slideShow);				slideShow.init();				slideShow.loadXML()				slideShow.name = 'photoGallery';				slideShow.x = 128;				slideShow.y = 62;								planeTitle.x = slideShow.x;				planeTitle.y = 440;				planeTitle.width = planeWidth - 60;				planeTitle.height = 60;				planeTitle.text = aPlanes[currentPlane]['title'];				planeTitle.visible = true;			} else if(aPlanes[currentPlane]['type'] == 'links')			{				if(getChildByName('linksDisplay')!= null)					removeChild(getChildByName('linksDisplay'));								linksWall = new LinksDisplay(urlPath+aPlanes[currentPlane]['data'],urlPath)				this.addChild(linksWall);				linksWall.init();				linksWall.loadXML();				linksWall.name = 'linksDisplay';				linksWall.x = 128;				linksWall.y = 62;								planeTitle.x = linksWall.x;				planeTitle.y = 440;				planeTitle.width = planeWidth - 60;				planeTitle.height = 60;				planeTitle.text = aPlanes[currentPlane]['title'];				planeTitle.visible = true;			} else if(aPlanes[currentPlane]['type'] == 'video') {				if(getChildByName('vimeoPlayer')!= null)					removeChild(getChildByName('vimeoPlayer'));								vplayer = new VimeoPlayer();				vplayer.startLoad(aPlanes[currentPlane]['data']);				this.addChild(vplayer);				vplayer.name = 'vimeoPlayer';				vplayer.x = 128;				vplayer.y = 100;				planeTitle.x = vplayer.x;				planeTitle.y = 440;				planeTitle.width = planeWidth - 60;				planeTitle.height = 60;				planeTitle.text = aPlanes[currentPlane]['title'];				planeTitle.visible = true;			} else if(aPlanes[currentPlane]['type'] == 'audio') {				if(getChildByName('audioPlayer')!= null)					removeChild(getChildByName('audioPlayer'));								aplayer = new AudioPlayer(aPlanes[currentPlane]['data'],urlPath);				this.addChild(aplayer);				aplayer.name = 'audioPlayer';				aplayer.init();				aplayer.loadXML();				aplayer.x = 128;				aplayer.y = 62;				planeTitle.x = aplayer.x;				planeTitle.y = 440;				planeTitle.width = planeWidth - 60;				planeTitle.height = 60;				planeTitle.text = aPlanes[currentPlane]['title'];				planeTitle.visible = true;			}		}				public function setFogFilter():void		{			renderer.filter = new FogFilter(new FogMaterial(0x000000), fogSegments, fogMin, fogDepth); 		}				public function movePlaneTo(cp:Plane,toX:Number,toY:Number,toZ:Number,d:String='0.2s'):void		{			var tweenX:KSTween = new KSTween(cp, "x", cp.x, toX, d, "0sec", Cubic.easeInOut);						var tweenY:KSTween = new KSTween(cp, "y", cp.y, toY, d, "0sec", Cubic.easeInOut);			var tweenZ:KSTween = new KSTween(cp, "z", cp.z, toZ, d, "0sec", Cubic.easeInOut);						var ksgroup:KSParallelGroup = new KSParallelGroup(				tweenX,				tweenY,				tweenZ			);			ksgroup.start();		}				public function changePlane(e:MouseEvent):void		{			var sp:Array = e.target.name.split('_');			nextPlane = int(sp[1]);			initTransition();		}				public function resetCamera(e:MouseEvent):void		{			cleanPlane();			showAllPlanes();			showNav();			resetPlanePositions();			moveCameraTo(0,0,-1000,false);		}				public function resetPlanePositions():void		{			var cp:Plane;			for(var i:int=0;i<aPlanes.length;i++) {				trace('about to reset plane '+aPlanes[i]['alias']);				cp = scene.getChildByName('plane_'+i) as Plane;				movePlaneTo(cp, aPlanes[i].x,aPlanes[i].y,aPlanes[i].z,'2s');				cp.visible = true;			}			filterPlanes();		}				public function initOverview():void		{			drawAllBranches();		}				public function filterPlanes(e:MouseEvent=null):void		{			var dirty:Boolean = false;			var cp:Plane;			for(var i:int=0;i<aPlanes.length;i++){				cp = scene.getChildByName('plane_'+i) as Plane;				switch (aPlanes[i]['type'])				{				case "video":					cp.visible = cb_videos.chk_videos.selected;				break;				case "links":					cp.visible = cb_links.chk_links.selected;				break;				case "audio":					cp.visible = cb_audio.chk_audio.selected;				break;				case "map":					cp.visible = cb_maps.chk_map.selected;				break;				case "slideshow":					cp.visible = cb_slideshows.chk_slideshows.selected;				break;				}								if(!cp.visible)					dirty = true;			}						if(dirty)				hideLines();		}				public function showNav():void		{			btn_zoomout.visible = false;			cb_slideshows.visible = true;			cb_videos.visible = true;			cb_audio.visible = true;			cb_links.visible = true;			cb_maps.visible = true;			bToolTip = true;		}				public function hideNav():void		{			btn_zoomout.visible = true;			cb_slideshows.visible = false;			cb_videos.visible = false;			cb_audio.visible = false;			cb_links.visible = false;			cb_maps.visible = false;			bToolTip = false;		}				public function initNav():void		{			trace('initNav');			btn_zoomout.visible = false;			btn_zoomout.addEventListener(MouseEvent.CLICK, resetCamera);			btn_moreinfo.addEventListener(MouseEvent.CLICK, showInfoOverlay);			cb_slideshows.chk_slideshows.addEventListener(MouseEvent.CLICK, filterPlanes);			cb_videos.chk_videos.addEventListener(MouseEvent.CLICK, filterPlanes);			cb_audio.chk_audio.addEventListener(MouseEvent.CLICK, filterPlanes);			cb_links.chk_links.addEventListener(MouseEvent.CLICK, filterPlanes);			cb_maps.chk_map.addEventListener(MouseEvent.CLICK, filterPlanes);						drawAllBranches();		}				public function hideToolTip():void {			var tween:KSTween = new KSTween(getChildByName('toolTip'), "alpha", getChildByName('toolTip').alpha, 0, "0.1sec", "0sec", Cubic.easeInOut);			tween.start();		}						public function drawAllBranches():void		{			for(var i:int=0;i<aPlanes.length;i++) {				if(aPlanes[i]['parent_alias'] == '')				{					drawBranchToChildren(aPlanes[i]['alias'],i);				}			}						bLines = true;		}				public function drawBranchToChildren(alias:String,id:int):void		{			var cp:Plane;			var np:Plane;						for(var i:int=0;i<aPlanes.length;i++) {				if(aPlanes[i]['parent_alias'] == alias)				{					cp = scene.getChildByName('plane_'+id) as Plane;					np = scene.getChildByName('plane_'+i) as Plane;					arrLines[0].addLine(new Line3D(arrLines[0], lineMaterial, 3, new Vertex3D(cp.x,cp.y,cp.z), new Vertex3D(np.x,np.y,np.z) ));					drawBranchToChildren(aPlanes[i]['alias'],i);				}			}		}				public function hideLines():void		{			var l:Lines3D = scene.getChildByName('line') as Lines3D;			l.removeAllLines();						bLines = false;		}				//		//		//				public function insertIntroText(e:Event):void {			introTextLoader.removeEventListener(Event.COMPLETE, insertIntroText);			scroll_text.text = e.target.data;			scroll_text.setTextFormat(introFormat);		}				public function scrollText( n:Number ) {			scroll_text.scrollV = Math.round( ( scroll_text.maxScrollV - 1 ) * n ) + 1;		}				public function fadeOutIntroOverlay(e:MouseEvent):void		{			//var tweenA:KSTween = new KSTween(intro_overlay, "alpha", intro_overlay.alpha, 0, "1sec", "0sec", Cubic.easeInOut);			var tweenDone:KSFunction = new KSFunction(0, removeIntroOverlay);						//var sequence:KSSequenceGroup = new KSSequenceGroup( tweenA, tweenDone );						//sequence.start();			tweenDone.start();		}				private function removeIntroOverlay():void		{			skipIntroBtn.removeEventListener(MouseEvent.CLICK, removeIntroOverlay);			this.removeChild(this.getChildByName('introOverlay'));		}				private function showInfoOverlay(e:MouseEvent):void		{			addChild(intro_overlay);		}				//		//		//	}}